name: Secret Message Decoder

on: [push, pull_request]

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Verify files structure
        run: |
          echo "ðŸ“ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
          [ -f "index.html" ] || (echo "âŒ index.html missing" && exit 1)
          [ -f "style.css" ] || (echo "âŒ style.css missing" && exit 1)
          [ -f "script.js" ] || (echo "âŒ script.js missing" && exit 1)
          echo "âœ… Ð’ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ"

      - name: Check HTML hints
        run: |
          echo "ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾Ð´ÑÐºÐ°Ð·Ð¾Ðº Ð² HTML..."
          if grep -q "U0x1ZHVqb3VqYXkgcG9kc2themsgdml6aSB2IGlzdG9yaWkgcmVwb3NpdG9yaWE=" index.html; then
            echo "âœ… Base64 Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ° Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð² HTML"
            HTML_HINT=$(grep -o 'U0x1ZHVqb3VqYXkgcG9kc2themsgdml6aSB2IGlzdG9yaWkgcmVwb3NpdG9yaWE=' index.html)
            DECODED=$(echo $HTML_HINT | base64 -d)
            echo "Ð Ð°ÑÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¾: $DECODED"
          else
            echo "âŒ ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ° Ð² HTML Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
            exit 1
          fi

      - name: Check CSS for key1
        run: |
          echo "ðŸ” ÐŸÐ¾Ð¸ÑÐº ÐºÐ»ÑŽÑ‡Ð° 1 Ð² CSS..."
          if grep -q "S2V5IDE6IHBhc3RlYmluLmNvbS9yYXcv" style.css; then
            echo "âœ… ÐšÐ»ÑŽÑ‡ 1 Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² CSS"
            CSS_KEY=$(grep -o 'S2V5IDE6IHBhc3RlYmluLmNvbS9yYXcv' style.css)
            DECODED=$(echo $CSS_KEY | base64 -d)
            echo "ÐšÐ»ÑŽÑ‡ 1: $DECODED"
          else
            echo "âŒ ÐšÐ»ÑŽÑ‡ 1 Ð² CSS Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
            exit 1
          fi

      - name: Check JS for key2 and logic
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° JavaScript Ð»Ð¾Ð³Ð¸ÐºÐ¸..."
          
          if grep -q "decodeMessage" script.js; then
            echo "âœ… Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ decodeMessage Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
          else
            echo "âŒ Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ decodeMessage Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
            exit 1
          fi
          
          if grep -q "fetch" script.js; then
            echo "âœ… Fetch API Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ"
          else
            echo "âŒ Fetch API Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ"
            exit 1
          fi
          
          if grep -q "atob" script.js; then
            echo "âœ… Base64 Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐµÑÑ‚ÑŒ"
          else
            echo "âŒ Base64 Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð½ÐµÑ‚"
            exit 1
          fi
          
          if grep -q "S2V5IDI6IDVM" script.js; then
            echo "âœ… ÐšÐ»ÑŽÑ‡ 2 Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² JS"
            JS_KEY=$(grep -o 'S2V5IDI6IDVM.*' script.js | head -1 | cut -d' ' -f1)
            DECODED=$(echo $JS_KEY | base64 -d)
            echo "ÐšÐ»ÑŽÑ‡ 2: $DECODED"
          else
            echo "âŒ ÐšÐ»ÑŽÑ‡ 2 Ð² JS Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
            exit 1
          fi

      - name: Test URL assembly and decoding
        run: |
          echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ÐºÐ¸..."
          cat > test_logic.js << 'EOF'
          function testURLLogic() {
              const testKey1 = "pastebin.com/raw/";
              const testKey2 = "testID123";
              const assembledURL = "https://" + testKey1 + testKey2;
          
              console.log("Ð¢ÐµÑÑ‚ ÑÐ±Ð¾Ñ€ÐºÐ¸ URL:");
              console.log("Ð¡Ð¾Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ URL:", assembledURL);
          
              if (assembledURL === "https://pastebin.com/raw/testID123") {
                  console.log("âœ… Ð›Ð¾Ð³Ð¸ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸ URL Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ");
                  return true;
              }
              return false;
          }
          
          function testBase64Logic() {
              const testMessage = "Ð¢ÐµÑÑ‚ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†Ñ‹";
              const base64Encoded = Buffer.from(testMessage, 'utf8').toString('base64');
              const base64Decoded = Buffer.from(base64Encoded, 'base64').toString('utf8');
          
              console.log("Ð¢ÐµÑÑ‚ Base64 Ñ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†ÐµÐ¹:");
              console.log("ÐžÑ€Ð¸Ð³Ð¸Ð½Ð°Ð»:", testMessage);
              console.log("Ð”ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾:", base64Decoded);
          
              if (base64Decoded === testMessage) {
                  console.log("âœ… Base64 Ñ ÐºÐ¸Ñ€Ð¸Ð»Ð»Ð¸Ñ†ÐµÐ¹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚");
                  return true;
              }
              return false;
          }
          
          if (testURLLogic() && testBase64Logic()) {
              console.log("ðŸŽ‰ Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹!");
          } else {
              throw new Error("Ð¢ÐµÑÑ‚Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹");
          }
          EOF
          node test_logic.js

      - name: Final check
        run: |
          echo "ðŸŽ¯ Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"